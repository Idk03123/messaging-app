<!DOCTYPE html>
<html>
<head>
  <title>Messaging App</title>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; background: #f0f0f0; }
    #chat { border: 1px solid #ccc; padding: 10px; height: 300px; width: 350px; margin: 10px auto; overflow-y: auto; background: white; }
    input, button { margin: 5px; padding: 8px; width: 300px; }
    #toCode { width: 200px; }
  </style>
</head>
<body>
  <h1>Mini Messenger</h1>
  <p>Your Code: <span id="myCode"></span></p>

  <input id="toCode" placeholder="Friend's code"><br>
  <div id="chat"></div>
  <input id="message" placeholder="Type a message">
  <button onclick="sendMessage()">Send</button>

  <script type="module">
    // Firebase imports
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
    import { getDatabase, ref, push, onChildAdded } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-database.js";

    // Your Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyCq58xU0o-PLkYD3r0Th-bRuxcz5aAjBOE",
      authDomain: "messaging-app-f1037.firebaseapp.com",
      databaseURL: "https://messaging-app-f1037-default-rtdb.firebaseio.com",
      projectId: "messaging-app-f1037",
      storageBucket: "messaging-app-f1037.appspot.com",
      messagingSenderId: "1029210287915",
      appId: "1:1029210287915:web:b1625929f6ac4bd520df6e"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // Generate 16-digit code
    const myCode = Math.floor(1000000000000000 + Math.random() * 9000000000000000).toString();
    document.getElementById("myCode").innerText = myCode;

    const chatBox = document.getElementById("chat");

    // Listen for messages sent to me
    onChildAdded(ref(db, "messages"), (snapshot) => {
      const msg = snapshot.val();
      if (msg.to === myCode) {
        let p = document.createElement("p");
        p.textContent = "Friend: " + msg.text;
        chatBox.appendChild(p);
        chatBox.scrollTop = chatBox.scrollHeight;
      }
    });

    // Send a message
    window.sendMessage = function() {
      const toCode = document.getElementById("toCode").value.trim();
      const text = document.getElementById("message").value.trim();
      if (!toCode || !text) return alert("Enter friend's code and a message.");

      // Push to Firebase
      push(ref(db, "messages"), {
        from: myCode,
        to: toCode,
        text: text
      });

      // Show locally
      let p = document.createElement("p");
      p.textContent = "Me: " + text;
      chatBox.appendChild(p);
      chatBox.scrollTop = chatBox.scrollHeight;

      document.getElementById("message").value = "";
    };
  </script>
</body>
</html>
